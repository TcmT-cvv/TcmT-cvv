<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard — PrintPro</title>
  <link rel="stylesheet" href="../css/style.css" />
</head>
<body>
  <header class="navbar">
    <span class="logo">PrintPro Admin</span>
    <nav>
      <a href="dashboard.html" class="active">Dashboard</a>
      <a href="orders.html">Orders</a>
      <a href="messages.html">Messages</a>
      <a href="tickets.html">Tickets</a>
    </nav>
    <div class="nav-right">
      <a href="../index.html" class="btn btn-sm btn-secondary">Back to Site</a>
    </div>
  </header>

  <main class="container">
    <div class="page-header">
      <h1>Dashboard</h1>
      <p>Overview of your printing service operations.</p>
    </div>

    <!-- Stats -->
    <div class="grid grid-4" id="statsGrid">
      <div class="card stat-card">
        <div class="stat-value" id="statOrders">0</div>
        <div class="stat-label">Total Orders</div>
      </div>
      <div class="card stat-card">
        <div class="stat-value" id="statPending">0</div>
        <div class="stat-label">Pending Orders</div>
      </div>
      <div class="card stat-card">
        <div class="stat-value" id="statMessages">0</div>
        <div class="stat-label">Unread Messages</div>
      </div>
      <div class="card stat-card">
        <div class="stat-value" id="statTickets">0</div>
        <div class="stat-label">Open Tickets</div>
      </div>
    </div>

    <!-- Recent Orders -->
    <div class="card mt-24">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <h2>Recent Orders</h2>
        <a href="orders.html" class="btn btn-sm btn-secondary">View All</a>
      </div>
      <div class="table-wrap mt-16">
        <table>
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Customer</th>
              <th>Type</th>
              <th>Qty</th>
              <th>Status</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody id="recentOrdersBody"></tbody>
        </table>
      </div>
    </div>

    <!-- Recent Messages & Tickets -->
    <div class="grid grid-2 mt-24">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <h2>Recent Messages</h2>
          <a href="messages.html" class="btn btn-sm btn-secondary">View All</a>
        </div>
        <div id="recentMessages" class="mt-16"></div>
      </div>
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <h2>Open Tickets</h2>
          <a href="tickets.html" class="btn btn-sm btn-secondary">View All</a>
        </div>
        <div id="recentTickets" class="mt-16"></div>
      </div>
    </div>
  </main>

  <script src="../js/store.js"></script>
  <script>
    Store.seedIfEmpty();

    const statusBadge = {
      pending: "badge-pending",
      "in-progress": "badge-progress",
      completed: "badge-completed",
      cancelled: "badge-cancelled"
    };

    const statusLabels = {
      pending: "Pending",
      "in-progress": "In Progress",
      completed: "Completed",
      cancelled: "Cancelled"
    };

    function escapeHtml(str) {
      const div = document.createElement("div");
      div.textContent = str;
      return div.innerHTML;
    }

    function render() {
      const orders = Store.getOrders();
      const messages = Store.getMessages();
      const tickets = Store.getTickets();

      // Stats
      document.getElementById("statOrders").textContent = orders.length;
      document.getElementById("statPending").textContent = orders.filter(o => o.status === "pending").length;
      document.getElementById("statMessages").textContent = messages.filter(m => !m.read).length;
      document.getElementById("statTickets").textContent = tickets.filter(t => t.status === "open").length;

      // Recent Orders (last 5)
      const tbody = document.getElementById("recentOrdersBody");
      tbody.innerHTML = "";
      orders.slice(-5).reverse().forEach(o => {
        const date = new Date(o.createdAt).toLocaleDateString();
        const badge = statusBadge[o.status] || "badge-pending";
        const label = statusLabels[o.status] || o.status;
        tbody.innerHTML += `<tr>
          <td><strong>${escapeHtml(o.id)}</strong></td>
          <td>${escapeHtml(o.customerName)}</td>
          <td>${escapeHtml(o.documentType)}</td>
          <td>${o.quantity}</td>
          <td><span class="badge ${badge}">${label}</span></td>
          <td>${date}</td>
        </tr>`;
      });
      if (orders.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="text-center" style="color:var(--text-light);">No orders yet.</td></tr>';
      }

      // Recent Messages (last 3)
      const msgEl = document.getElementById("recentMessages");
      msgEl.innerHTML = "";
      messages.slice(-3).reverse().forEach(m => {
        const date = new Date(m.createdAt).toLocaleDateString();
        const readDot = m.read ? "" : ' style="font-weight:700;"';
        msgEl.innerHTML += `<div class="ticket">
          <div class="ticket-info">
            <h4${readDot}>${escapeHtml(m.subject)}</h4>
            <p>${escapeHtml(m.name)} &middot; ${date}</p>
          </div>
        </div>`;
      });
      if (messages.length === 0) {
        msgEl.innerHTML = '<p style="color:var(--text-light);">No messages yet.</p>';
      }

      // Recent Tickets (open only, last 3)
      const ticketEl = document.getElementById("recentTickets");
      ticketEl.innerHTML = "";
      tickets.filter(t => t.status === "open").slice(-3).reverse().forEach(t => {
        const date = new Date(t.createdAt).toLocaleDateString();
        ticketEl.innerHTML += `<div class="ticket">
          <div class="ticket-info">
            <h4>${escapeHtml(t.id)} — ${escapeHtml(t.orderId || "General")}</h4>
            <p>${escapeHtml(t.name)} &middot; ${date}</p>
          </div>
          <span class="badge badge-pending">Open</span>
        </div>`;
      });
      if (tickets.filter(t => t.status === "open").length === 0) {
        ticketEl.innerHTML = '<p style="color:var(--text-light);">No open tickets.</p>';
      }
    }

    render();
  </script>
</body>
</html>
